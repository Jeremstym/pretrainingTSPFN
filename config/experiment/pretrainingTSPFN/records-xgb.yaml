# @package _global_

defaults:
  - /task/data: tabular
  - /data: orchid

data:
  patients_kwargs:
    views: [A4C, A2C]   # Needed to avoid warnings about missing views when defaulting to all views (including A3C)
  process_patient_kwargs:
    tabular_attrs:
      - ef
      - esv
      - edv
      - a4c_ed_sc_min
      - a4c_ed_sc_max
      - a4c_ed_lc_min
      - a4c_ed_lc_max
      - a2c_ed_ic_min
      - a2c_ed_ic_max
      - a2c_ed_ac_min
      - a2c_ed_ac_max
      - a3c_ed_ilc_min
      - a3c_ed_ilc_max
      - a3c_ed_asc_min
      - a3c_ed_asc_max
      - age
      - sex
      - bmi
      - stroke
      - tobacco
      - diabetes
      - dyslipidemia
      - arb
      - tz_diuretic
      - alpha_blocker
      - ccb
      - hb
      - antipla
      - anticoag
      - lp_diuritique
      - k_diuritique
      - arni
      - proteinuria
      - creatinuria
      - microalbuminuria
      - sbp_tte
      - dbp_tte
      - hr_tte
      - creat
      - gfr
      - nt_probnp
      - e_velocity
      - a_velocity
      - mv_dt
      - lateral_e_prime
      - septal_e_prime
      - e_e_prime_ratio
      - lvm_ind
      - lvh
      - ivs_d
      - lvid_d
      - pw_d
      - paps
      - ti_pgmax
      - lbbb
      - rbbb
      - rhythm
      - pr_interval
      - qrs_interval
      - qt_interval
      - r_axis
      - sa_ev
      - diagnosis
    time_series_attrs:
      - gls
      - ls_left
      - ls_right
      - lv_area
      - lv_length
      - myo_thickness_left
      - myo_thickness_right

task:
  _target_: didactic.tasks.cardiac_records_prediction.CardiacRecordsPredictionTask
  save_model: False
  use_time_series: False
  target_attr: diagnosis
  task.use_multiprocessing: False

  model:
    _target_: xgboost.XGBClassifier
    enable_categorical: True
    random_state: 42
  # model:
  #   _target_: tabpfn.TabPFNClassifier
  #   random_state: 42
  #   n_estimators: 1


exclude_tabular_attrs: []
# Determine the number of tabular attributes used by the model based on the config
n_tabular_attrs: ${builtin.len:${task.tabular_attrs}}

model_ckpt: xgb-model.json
scores_filename: test_categorical_scores.csv


experiment_dirname: model=${hydra:runtime.choices.task/model}/data=${hydra:runtime.choices.task/data}/target=${task.target_attr}
hydra:
  job:
    config:
      override_dirname:
        exclude_keys:
          - hydra/launcher
          - hydra.launcher.n_jobs
          - hydra.run.dir
          - hydra.sweep.dir
          - hydra.sweep.subdir

          - experiment

          - exclude_tabular_attrs
          - task/data
          - task.tabular_attrs
          - task.time_series_attrs
          - task.target_attr

  run:
    dir: ${oc.env:OUTPUT_DIR}/records-xgb/${experiment_dirname}/${hydra.job.override_dirname}
  sweep:
    dir: ${oc.env:OUTPUT_DIR}/records-xgb/
    subdir: ${experiment_dirname}/${hydra.job.override_dirname}
